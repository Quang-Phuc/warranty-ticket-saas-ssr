<div class="table-shell">
    <!-- Header -->
    <div class="table-head">
        <div class="h-left">
            <div class="title-row">
                <h2 class="t-title">{{ title() }}</h2>
                <span class="pill" *ngIf="total()">{{ total() | number }} items</span>
                <span class="pill ok" *ngIf="selectedRows().length && enableSelect()">
          ‚úÖ ƒê√£ ch·ªçn {{ selectedRows().length }}
                    <button class="mini-x" (click)="clearSelection()">‚úï</button>
        </span>
            </div>

            <p class="t-sub" *ngIf="subtitle()">{{ subtitle() }}</p>
        </div>

        <div class="h-right">
            <!-- Search -->
            <div class="search" *ngIf="enableSearch()">
                <span class="si">üîé</span>
                <input
                        class="search-input"
                        [ngModel]="searchTerm()"
                        (ngModelChange)="onSearchInput($event)"
                        [placeholder]="searchPlaceholder()"
                />
                <button
                        class="clear"
                        type="button"
                        *ngIf="searchTerm()"
                        (click)="clearSearch()"
                        aria-label="Clear"
                >
                    ‚úï
                </button>
            </div>

            <!-- Column picker -->
            <div class="col-picker" *ngIf="enableColumnPicker()">
                <button class="icon-btn" type="button" (click)="toggleColPicker()">
                    üß© C·ªôt
                    <span class="dot" *ngIf="hasAnyHidden()"></span>
                </button>

                <div class="picker-pop" *ngIf="openColPicker()">
                    <div class="picker-title">
                        <strong>·∫®n/Hi·ªán c·ªôt</strong>
                        <button class="link" (click)="resetColumns()">Reset</button>
                    </div>

                    <div class="picker-list">
                        <label class="pick" *ngFor="let c of (localCols().length ? localCols() : columns())">
                            <input type="checkbox" [checked]="!c.hidden" (change)="toggleColumn(c)" />
                            <span>{{ c.label }}</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Export -->
            <button class="icon-btn" type="button" *ngIf="enableExport()" (click)="exportCsv()">
                ‚§ì CSV
            </button>
        </div>
    </div>

    <!-- Table Card -->
    <div class="card">
        <!-- Loading overlay -->
        <div class="overlay" *ngIf="loading()">
            <div class="spinner"></div>
            <div class="ov-txt">ƒêang t·∫£i d·ªØ li·ªáu...</div>
        </div>

        <!-- Desktop table -->
        <div class="table-wrap">
            <table class="table">
                <thead>
                <tr>
                    <th class="th-check" *ngIf="enableSelect()">
                        <input
                                type="checkbox"
                                [checked]="allChecked()"
                                [indeterminate]="someChecked()"
                                (change)="toggleAll()"
                        />
                    </th>

                    <th
                            *ngFor="let c of visibleColumns(); trackBy: trackByCol"
                            [style.width]="c.width || null"
                            [class.sortable]="c.sortable"
                            [class.center]="c.align === 'center'"
                            [class.right]="c.align === 'right'"
                            (click)="onSort(c)"
                    >
                        <div class="th-inner">
                            <span>{{ c.label }}</span>

                            <span class="sort" *ngIf="c.sortable">
                  <span class="up" [class.on]="isSortedAsc(String(c.key))">‚ñ≤</span>
                  <span class="down" [class.on]="isSortedDesc(String(c.key))">‚ñº</span>
                </span>
                        </div>
                    </th>

                    <th class="th-actions" *ngIf="actions()?.length"> </th>
                </tr>
                </thead>

                <tbody>
                <!-- Skeleton rows -->
                <tr class="sk" *ngIf="loading()">
                    <td [attr.colspan]="visibleColumns().length + (enableSelect()?1:0) + (actions()?.length?1:0)">
                        <div class="skeleton">
                            <div class="srow" *ngFor="let _ of [1,2,3,4,5,6]">
                                <div class="scol" *ngFor="let __ of [1,2,3,4,5]"></div>
                            </div>
                        </div>
                    </td>
                </tr>

                <!-- Empty -->
                <tr *ngIf="!loading() && rows().length === 0">
                    <td
                            class="empty"
                            [attr.colspan]="visibleColumns().length + (enableSelect()?1:0) + (actions()?.length?1:0)"
                    >
                        <div class="empty-box">
                            <div class="e-ic">üì≠</div>
                            <div class="e-title">Kh√¥ng c√≥ d·ªØ li·ªáu</div>
                            <div class="e-sub">H√£y th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c t√¨m ki·∫øm kh√°c.</div>
                        </div>
                    </td>
                </tr>

                <!-- Data -->
                <tr *ngFor="let row of rows(); let i = index; trackBy: trackByRow" class="row">
                    <td class="td-check" *ngIf="enableSelect()">
                        <input type="checkbox" [checked]="selectedKeys().has(i)" (change)="toggleRow(i)" />
                    </td>

                    <td
                            *ngFor="let c of visibleColumns(); trackBy: trackByCol"
                            [class.center]="c.align === 'center'"
                            [class.right]="c.align === 'right'"
                    >
                        <!-- Types -->
                        <ng-container [ngSwitch]="c.type || 'text'">

                            <!-- avatar -->
                            <ng-container *ngSwitchCase="'avatar'">
                                <div class="avatar-cell">
                                    <img
                                            class="ava"
                                            [src]="getCellValue(row, c)"
                                            *ngIf="getCellValue(row, c)"
                                            alt="avatar"
                                            referrerpolicy="no-referrer"
                                    />
                                    <div class="ava-fallback" *ngIf="!getCellValue(row, c)">üë§</div>
                                    <div class="ava-text">
                                        <div class="main">{{ row['name'] || row['fullName'] || row['username'] || '‚Äî' }}</div>
                                        <div class="sub">{{ row['email'] || row['phone'] || '' }}</div>
                                    </div>
                                </div>
                            </ng-container>

                            <!-- money -->
                            <ng-container *ngSwitchCase="'money'">
                                <span class="money">{{ formatMoney(getCellValue(row, c)) }}</span>
                            </ng-container>

                            <!-- date -->
                            <ng-container *ngSwitchCase="'date'">
                                <span class="date">{{ formatDate(getCellValue(row, c)) }}</span>
                            </ng-container>

                            <!-- badge -->
                            <ng-container *ngSwitchCase="'badge'">
                  <span class="badge" [attr.data-tone]="c.badgeTone ? c.badgeTone(row) : 'gray'">
                    {{ getCellValue(row, c) }}
                  </span>
                            </ng-container>

                            <!-- default text -->
                            <ng-container *ngSwitchDefault>
                                <span class="txt" [title]="getCellValue(row, c)">{{ getCellValue(row, c) }}</span>
                            </ng-container>
                        </ng-container>
                    </td>

                    <!-- Actions -->
                    <td class="td-actions" *ngIf="actions()?.length">
                        <div class="row-actions">
                            <button class="dots" type="button" (click)="toggleRowActions(i, $event)">‚ãØ</button>

                            <div class="actions-pop" *ngIf="openRowActionIndex() === i">
                                <button
                                        class="act"
                                        *ngFor="let a of actions()"
                                        [class.danger]="a.tone === 'danger'"
                                        type="button"
                                        (click)="runAction(a, row, $event)"
                                >
                                    <span class="ic">{{ a.icon || '‚Ä¢' }}</span>
                                    <span>{{ a.label }}</span>
                                </button>
                            </div>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="foot" *ngIf="total() > 0">
            <div class="foot-left">
        <span class="muted">
          Hi·ªÉn th·ªã <strong>{{ from() }}</strong> - <strong>{{ to() }}</strong> / {{ total() | number }}
        </span>
            </div>

            <div class="foot-right">
                <div class="size">
                    <span class="muted">Hi·ªÉn th·ªã</span>
                    <select [ngModel]="pageSize()" (ngModelChange)="onPageSizeChange($event)">
                        <option *ngFor="let s of pageSizes" [value]="s">{{ s }}</option>
                    </select>
                    <span class="muted">/ trang</span>
                </div>

                <div class="pager">
                    <button class="pbtn" type="button" (click)="goPrev()" [disabled]="page() === 0">‚Üê</button>

                    <button
                            class="pbtn"
                            type="button"
                            *ngFor="let p of pagesToShow()"
                            [class.active]="p === page()"
                            (click)="goPage(p)"
                    >
                        {{ p + 1 }}
                    </button>

                    <button class="pbtn" type="button" (click)="goNext()" [disabled]="page() >= totalPages() - 1">‚Üí</button>
                </div>
            </div>
        </div>
    </div>
</div>
