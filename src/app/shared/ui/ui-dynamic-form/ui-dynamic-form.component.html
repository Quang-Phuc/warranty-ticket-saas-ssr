<div class="grid">
    <div class="field" *ngFor="let f of sortedVisibleFields()">
        <ng-container [ngSwitch]="f.type">

            <!-- text -->
            <mat-form-field *ngSwitchCase="'text'" appearance="outline" class="full">
                <mat-label>{{ f.label }} <span *ngIf="f.required" style="color:#f87171">*</span></mat-label>
                <input matInput
                       [placeholder]="f.placeholder || ''"
                       [disabled]="readonly() || (f.disabled?.(model()) ?? false)"
                       [ngModel]="getValue(f.key)"
                       (ngModelChange)="patch(f.key, $event)"
                />
                <mat-error *ngIf="errorOf(f.key)">{{ errorOf(f.key) }}</mat-error>
            </mat-form-field>

            <!-- number -->
            <mat-form-field *ngSwitchCase="'number'" appearance="outline" class="full">
                <mat-label>{{ f.label }}</mat-label>
                <input matInput type="number"
                       [placeholder]="f.placeholder || ''"
                       [disabled]="readonly() || (f.disabled?.(model()) ?? false)"
                       [ngModel]="getValue(f.key)"
                       (ngModelChange)="patch(f.key, $event)"
                />
                <mat-error *ngIf="errorOf(f.key)">{{ errorOf(f.key) }}</mat-error>
            </mat-form-field>

            <!-- textarea -->
            <mat-form-field *ngSwitchCase="'textarea'" appearance="outline" class="full">
                <mat-label>{{ f.label }}</mat-label>
                <textarea matInput rows="4"
                          [placeholder]="f.placeholder || ''"
                          [disabled]="readonly() || (f.disabled?.(model()) ?? false)"
                          [ngModel]="getValue(f.key)"
                          (ngModelChange)="patch(f.key, $event)"
                ></textarea>
                <mat-error *ngIf="errorOf(f.key)">{{ errorOf(f.key) }}</mat-error>
            </mat-form-field>

            <!-- select -->
            <mat-form-field *ngSwitchCase="'select'" appearance="outline" class="full">
                <mat-label>{{ f.label }}</mat-label>
                <mat-select
                        [disabled]="readonly() || (f.disabled?.(model()) ?? false)"
                        [value]="getValue(f.key)"
                        (selectionChange)="patch(f.key, $event.value)"
                >
                    <mat-option [value]="null">-- Ch·ªçn --</mat-option>
                    <mat-option *ngFor="let opt of f.options || []" [value]="opt.value">{{ opt.label }}</mat-option>
                </mat-select>
                <mat-error *ngIf="errorOf(f.key)">{{ errorOf(f.key) }}</mat-error>
            </mat-form-field>

            <!-- date -->
            <mat-form-field *ngSwitchCase="'date'" appearance="outline" class="full">
                <mat-label>{{ f.label }}</mat-label>
                <input matInput type="date"
                       [disabled]="readonly() || (f.disabled?.(model()) ?? false)"
                       [ngModel]="getValue(f.key)"
                       (ngModelChange)="patch(f.key, $event)"
                />
                <mat-error *ngIf="errorOf(f.key)">{{ errorOf(f.key) }}</mat-error>
            </mat-form-field>

            <!-- checkbox -->
            <mat-checkbox *ngSwitchCase="'checkbox'"
                          [disabled]="readonly() || (f.disabled?.(model()) ?? false)"
                          [ngModel]="getValue(f.key)"
                          (ngModelChange)="patch(f.key, $event)"
            >
                {{ f.label }}
            </mat-checkbox>

            <!-- switch -->
            <mat-slide-toggle *ngSwitchCase="'switch'"
                              [disabled]="readonly() || (f.disabled?.(model()) ?? false)"
                              [ngModel]="getValue(f.key)"
                              (ngModelChange)="patch(f.key, $event)"
            >
                {{ f.label }}
            </mat-slide-toggle>

            <!-- upload: file -->
            <div *ngSwitchCase="'file'" class="full">
                {{ f.label }} <span *ngIf="f.required" style="color:#f87171">*</span>
                <ui-upload-field
                        mode="file"
                        [accept]="f.accept || '*/*'"
                        [disabled]="readonly() || (f.disabled?.(model()) ?? false)"
                        [value]="getValue(f.key)"
                        (valueChange)="patch(f.key, $event)"
                ></ui-upload-field>
                <div class="err" *ngIf="errorOf(f.key)">{{ errorOf(f.key) }}</div>
            </div>

            <!-- upload: files -->
            <div *ngSwitchCase="'files'" class="full">
                <div class="label">{{ f.label }}</div>
                <ui-upload-field
                        mode="files"
                        [accept]="f.accept || '*/*'"
                        [disabled]="readonly() || (f.disabled?.(model()) ?? false)"
                        [value]="getValue(f.key)"
                        (valueChange)="patch(f.key, $event)"
                ></ui-upload-field>
                <div class="err" *ngIf="errorOf(f.key)">{{ errorOf(f.key) }}</div>
            </div>

            <!-- upload: image -->
            <div *ngSwitchCase="'image'" class="full">
                <div class="label">{{ f.label }}</div>
                <ui-upload-field
                        mode="image"
                        accept="image/*"
                        [disabled]="readonly() || (f.disabled?.(model()) ?? false)"
                        [value]="getValue(f.key)"
                        (valueChange)="patch(f.key, $event)"
                ></ui-upload-field>
                <div class="err" *ngIf="errorOf(f.key)">{{ errorOf(f.key) }}</div>
            </div>

            <!-- upload: images -->
            <div *ngSwitchCase="'images'" class="full">
                <div class="label">{{ f.label }}</div>
                <ui-upload-field
                        mode="images"
                        accept="image/*"
                        [disabled]="readonly() || (f.disabled?.(model()) ?? false)"
                        [value]="getValue(f.key)"
                        (valueChange)="patch(f.key, $event)"
                ></ui-upload-field>
                <div class="err" *ngIf="errorOf(f.key)">{{ errorOf(f.key) }}</div>
            </div>

        </ng-container>
    </div>
</div>
