<!-- purchase-license.component.html -->
<div class="license-wrapper">

  <section class="hero">
    <div class="container">
      <div class="hero-grid">

        <div class="hero-left reveal" [class.in-view]="inView.hero">
          <div class="badge-new">
            <span class="dot"></span>
            License ch√≠nh h√£ng ¬∑ K√≠ch ho·∫°t nhanh
          </div>

          <h1>Ch·ªçn g√≥i <span>License</span> ph√π h·ª£p</h1>

          <p class="hero-sub">
            Mua m·ªõi ho·∫∑c gia h·∫°n license ƒë·ªÉ m·ªü kh√≥a to√†n b·ªô t√≠nh nƒÉng qu·∫£n l√Ω b·∫£o h√†nh & tickets.
            Thanh to√°n QR c·ª±c nhanh, x√°c nh·∫≠n t·ª± ƒë·ªông.
          </p>

          <div class="hero-cta">
            <button class="btn-main-trial btn-cta-pop" type="button" (click)="scrollToPricing()">
              <span class="sparkle">‚ú®</span>
              Xem b·∫£ng gi√°
              <span class="arrow">‚Üí</span>
            </button>

            <button class="btn-secondary" type="button" (click)="scrollToCompare()">
              So s√°nh g√≥i
            </button>
          </div>

          <div class="hero-proof">
            <div class="proof-item">
              <div class="kpi">{{ plans.length || 0 }}</div>
              <div class="kpi-sub">G√≥i license</div>
            </div>
            <div class="proof-item">
              <div class="kpi">QR</div>
              <div class="kpi-sub">Thanh to√°n nhanh</div>
            </div>
            <div class="proof-item">
              <div class="kpi">Auto</div>
              <div class="kpi-sub">X√°c nh·∫≠n t·ª± ƒë·ªông</div>
            </div>
          </div>
        </div>

        <div class="hero-right reveal" [class.in-view]="inView.hero" style="--d:120ms">
          <div class="glass-card-preview">
            <div class="preview-top">
              <span class="mini-dot red"></span>
              <span class="mini-dot yellow"></span>
              <span class="mini-dot green"></span>
              <div class="mini-title">License Checkout</div>
            </div>

            <div class="preview-body">
              <div class="preview-metrics">
                <div class="metric">
                  <div class="metric-title">T√≠nh nƒÉng</div>
                  <div class="metric-value good">Full</div>
                </div>
                <div class="metric">
                  <div class="metric-title">Th·ªùi h·∫°n</div>
                  <div class="metric-value">30‚Äì365</div>
                </div>
                <div class="metric">
                  <div class="metric-title">H·ªó tr·ª£</div>
                  <div class="metric-value">24/7</div>
                </div>
              </div>

              <div class="preview-footer">
                <div class="cta-mini"><span class="ic">üîí</span> B·∫£o m·∫≠t</div>
                <div class="cta-mini"><span class="ic">‚ö°</span> Nhanh</div>
                <div class="cta-mini"><span class="ic">‚úÖ</span> Chu·∫©n</div>
              </div>
            </div>

            <div class="floating-tag t1">üéÅ ∆Øu ƒë√£i theo g√≥i</div>
            <div class="floating-tag t2">üìå G√≥i ph·ªï bi·∫øn</div>
            <div class="floating-tag t3">‚ö° X√°c nh·∫≠n nhanh</div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- PRICING -->
  <section class="section section-soft" #pricingEl>
    <div class="container">
      <div class="section-head reveal" [class.in-view]="inView.pricing">
        <h2>Pricing</h2>
        <p>Ch·ªçn g√≥i ph√π h·ª£p v·ªõi nhu c·∫ßu ‚Äì t·ªëi ∆∞u chi ph√≠, k√≠ch ho·∫°t nhanh.</p>
      </div>

      <div class="loading" *ngIf="loading">
        <div class="spinner"></div>
        <div class="txt">ƒêang t·∫£i g√≥i license...</div>
      </div>

      <div class="pricing-grid" *ngIf="!loading">
        <div
          class="price-card reveal"
          *ngFor="let p of plans; index as i"
          [class.popular]="p.isPopular"
          [style.--d]="(i * 70) + 'ms'"
          [class.in-view]="inView.pricing"
        >
          <div class="pill-pop" *ngIf="p.isPopular">Ph·ªï bi·∫øn nh·∫•t</div>

          <h3>{{ p.name }}</h3>
          <p class="price-sub">{{ p.description || 'G√≥i license ph√π h·ª£p ƒë·ªÉ m·ªü kh√≥a t√≠nh nƒÉng.' }}</p>

          <div class="price">
            <div class="num">{{ finalPrice(p) | number }}</div>
            <div class="unit">VND / {{ p.durationDays }} ng√†y</div>
          </div>

          <div class="discount" *ngIf="p.discount && p.discount > 0">
            <span class="old">{{ p.price | number }}</span>
            <span class="off">-{{ p.discount }}%</span>
          </div>

          <ul class="price-list">
            <li *ngFor="let f of p.features || []">‚úÖ {{ f }}</li>
          </ul>

          <button class="btn-main-trial w-full" type="button" (click)="selectPlan(p)">
            Mua ngay
            <span class="arrow">‚Üí</span>
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- COMPARE -->
  <section class="section" #compareEl>
    <div class="container">
      <div class="section-head reveal" [class.in-view]="inView.compare">
        <h2>B·∫£ng so s√°nh</h2>
        <p>Ki·ªÉu Stripe/Notion ‚Äî nh√¨n 1 l·∫ßn l√† hi·ªÉu g√≥i n√†o h·ª£p.</p>
      </div>

      <div class="compare-wrap reveal" [class.in-view]="inView.compare">
        <div class="compare-scroll">
          <table class="compare-table">
            <thead>
            <tr>
              <th class="feature-col">T√≠nh nƒÉng</th>
              <th *ngFor="let p of plans">{{ p.name }}</th>
            </tr>
            </thead>

            <tbody>
            <tr *ngFor="let row of compareRows">
              <td class="feature-col">
                <div class="f-title">{{ row.title }}</div>
                <div class="f-sub">{{ row.desc }}</div>
              </td>

              <td *ngFor="let p of plans" [class.best]="p.isPopular">
                <ng-container [ngSwitch]="row.key">
                  <span *ngSwitchCase="'store'">{{ hasFeature(p, row.key) }}</span>
                  <span *ngSwitchCase="'user'">{{ hasFeature(p, row.key) }}</span>
                  <span *ngSwitchDefault>
                      <span *ngIf="hasFeature(p, row.key) as ok">{{ ok === true ? '‚úÖ' : ok }}</span>
                      <span *ngIf="!hasFeature(p, row.key)">‚Äî</span>
                    </span>
                </ng-container>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="highlight-box reveal" [class.in-view]="inView.compare" style="--d:120ms">
        <div class="h-left">
          <h3>Thanh to√°n & k√≠ch ho·∫°t</h3>
          <p>Ch·ªçn g√≥i ‚Üí t·∫°o QR ‚Üí thanh to√°n ‚Üí x√°c nh·∫≠n t·ª± ƒë·ªông.</p>
        </div>
        <div class="h-right">
          <button class="btn-main-trial" type="button" (click)="scrollToPricing()">
            Mua license ngay <span class="arrow">‚Üí</span>
          </button>
          <div class="tiny-note">B·∫£o m·∫≠t, nhanh v√† chu·∫©n.</div>
        </div>
      </div>
    </div>
  </section>

  <!-- PAYMENT MODAL -->
  <div class="modal" *ngIf="paymentOpen" (click)="closePayment()">
    <div class="modal-card" (click)="$event.stopPropagation()">
      <div class="modal-head">
        <div class="ttl">
          <strong>Thanh to√°n</strong>
          <span *ngIf="selected()">¬∑ {{ selected()?.name }}</span>
        </div>
        <button class="icon-close" type="button" (click)="closePayment()">‚úï</button>
      </div>

      <div class="modal-body" *ngIf="selected() as s">
        <div class="pay-grid">

          <div class="bank-card">
            <div class="bank-title">Th√¥ng tin chuy·ªÉn kho·∫£n</div>

            <div class="kv">
              <span>S·ªë ti·ªÅn</span>
              <strong class="hl">{{ finalPrice(s) | number }} VND</strong>
            </div>

            <div class="transfer">
              <label>N·ªôi dung chuy·ªÉn kho·∫£n</label>
              <input class="input" [value]="transferContent" readonly />
              <div class="hint">
                Vui l√≤ng chuy·ªÉn ƒë√∫ng s·ªë ti·ªÅn + n·ªôi dung ƒë·ªÉ h·ªá th·ªëng t·ª± x√°c nh·∫≠n.
              </div>
            </div>

            <button
              class="btn-main-trial w-full"
              type="button"
              [disabled]="confirming"
              (click)="confirmTransfer()"
            >
              {{ confirming ? 'ƒêang g·ª≠i x√°c nh·∫≠n...' : 'T√¥i ƒë√£ chuy·ªÉn kho·∫£n' }}
            </button>
          </div>

          <div class="qr-card">
            <div class="qr-title">Qu√©t QR</div>

            <div class="qr-box" *ngIf="generatingQr">
              <div class="spinner sm"></div>
              <p>ƒêang t·∫°o m√£ QR...</p>
            </div>

            <div class="qr-box" *ngIf="!generatingQr && qrBase64">
              <img [src]="'data:image/png;base64,' + qrBase64" alt="QR Code" />
              <p>Qu√©t ƒë·ªÉ thanh to√°n nhanh ch√≥ng.</p>
            </div>

            <div class="qr-box err" *ngIf="!generatingQr && !qrBase64">
              <div class="warn">‚ö†Ô∏è</div>
              <p>Kh√¥ng t·∫°o ƒë∆∞·ª£c QR. H√£y th·ª≠ l·∫°i.</p>
            </div>
          </div>

        </div>

        <div class="msg" *ngIf="message">{{ message }}</div>
      </div>
    </div>
  </div>

  <!-- floating CTA -->
  <div class="floating-cta" [class.show]="showFloatingCta">
    <div class="floating-inner">
      <div class="floating-text">
        <strong>Mua/Gia h·∫°n license ƒë·ªÉ m·ªü kh√≥a to√†n b·ªô t√≠nh nƒÉng.</strong>
        <span>Thanh to√°n QR ¬∑ X√°c nh·∫≠n t·ª± ƒë·ªông ¬∑ H·ªó tr·ª£ 24/7</span>
      </div>
      <button class="btn-white-trial" type="button" (click)="scrollToPricing()">
        Xem g√≥i gi√°
      </button>
    </div>
  </div>
</div>
